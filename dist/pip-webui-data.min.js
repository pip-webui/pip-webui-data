!function(e){"use strict";e.module("pipData",["pipDataConfig","pipDataDocument","pipDataUser","pipDataParty","pipDataSession","pipUsersData","pipDataSettings","pipCacheTag","pipDataTag","pipCacheAnnouncement","pipDataAnnouncement","pipCacheFeedback","pipDataFeedback","pipCacheImageSet","pipDataImageSets","pipCacheGuide","pipDataGuide","pipCacheTip","pipDataTip"])}(window.angular),function(){"use strict";var e=angular.module("pipCacheAnnouncement",["pipDataAnnouncement"]);e.service("pipCacheAnnouncement",["pipEnums","pipDataCache","pipCacheTag",function(e,t,n){function i(e,n,i){return e=e||{},e.resource="announces",e.item=e.item||{},t.retrieveOrLoad(e,n,i)}function a(e,i){return t.addDecorator("announces",e,n.tagsUpdateDecorator(e,i))}function r(e,i){return t.updateDecorator("announces",e,n.tagsUpdateDecorator(e,i))}function s(e,n){return t.removeDecorator("announces",e,n)}return{readAnnounces:i,onAnnounceCreate:a,onAnnounceUpdate:r,onAnnounceDelete:s}}])}(),function(){"use strict";var e=angular.module("pipCacheFeedback",["pipDataFeedback"]);e.service("pipCacheFeedback",["pipEnums","pipDataCache","pipCacheTag",function(e,t,n){function i(e,n,i){return e=e||{},e.resource="feedbacks",e.item=e.item||{},t.retrieveOrLoad(e,n,i)}function a(e,i){return t.addDecorator("feedbacks",e,n.tagsUpdateDecorator(e,i))}function r(e,i){return t.updateDecorator("feedbacks",e,n.tagsUpdateDecorator(e,i))}function s(e,n){return t.removeDecorator("feedbacks",e,n)}return{readFeedbacks:i,onFeedbackCreate:a,onFeedbackUpdate:r,onFeedbackDelete:s}}])}(),function(){"use strict";var e=angular.module("pipCacheGuide",["pipDataGuide","pipCacheTag"]);e.service("pipCacheGuide",["pipEnums","pipDataCache","pipCacheTag",function(e,t,n){function i(e,n,i){return e=e||{},e.resource="guides",e.item=e.item||{},t.retrieveOrLoad(e,n,i)}function a(e,i){return t.addDecorator("guides",e,n.tagsUpdateDecorator(e,i))}function r(e,i){return t.updateDecorator("guides",e,n.tagsUpdateDecorator(e,i))}function s(e,n){return t.removeDecorator("guides",e,n)}return{readGuides:i,onGuideCreate:a,onGuideUpdate:r,onGuideDelete:s}}])}(),function(){"use strict";var e=angular.module("pipCacheImageSet",["pipDataImageSets"]);e.service("pipCacheImageSet",["pipEnums","pipDataCache","pipCacheTag",function(e,t,n){function i(e,n,i){return e=e||{},e.resource="image_sets",e.item=e.item||{},t.retrieveOrLoad(e,n,i)}function a(e,i){return t.addDecorator("image_sets",e,n.tagsUpdateDecorator(e,i))}function r(e,i){return t.updateDecorator("image_sets",e,n.tagsUpdateDecorator(e,i))}function s(e,n){return t.removeDecorator("image_sets",e,n)}return{readImageSets:i,onImageSetCreate:a,onImageSetUpdate:r,onImageSetDelete:s}}])}(),function(){"use strict";var e=angular.module("pipCacheTag",["pipUtils","pipDataCache"]);e.service("pipCacheTag",["pipTags","pipDataCache",function(e,t){function n(n,i){var a=i?e.extractTags(i):[];if(0!=a.length){var r="partyTags";n&&null!==n.party_id&&void 0!==n.party_id?r=r+"_"+n.party_id:n&&n.item&&null!==n.item.party_id&&void 0!==n.item.party_id&&(r=r+"_"+n.item.party_id);var s=t.retrieve(r);s&&(_.each(a,function(t){var n=_.find(s.tags,function(n){return e.equalTags(n.tag,t)});n?(n.tag=t,n.count=n.count+1,n.used=new Date):(s.tags||(s.tags=[]),s.tags.push({tag:t,count:1,used:new Date}))}),t.store(r,s))}}function i(e,t){return function(i){n(e,i),t&&t(i)}}function a(e,n,i){return e.resource="partyTags",e.singleResult=!0,t.retrieveOrLoad(e,n,i)}function r(e,t){return i(e,t)}return{readTags:a,onTagsUpdate:r,tagsUpdateDecorator:i}}])}(),function(){"use strict";var e=angular.module("pipCacheTip",["pipDataTip"]);e.service("pipCacheTip",["pipEnums","pipDataCache","pipCacheTag",function(e,t,n){function i(e,n,i){return e=e||{},e.resource="tips",e.item=e.item||{},t.retrieveOrLoad(e,n,i)}function a(e,i){return t.addDecorator("tips",e,n.tagsUpdateDecorator(e,i))}function r(e,i){return t.updateDecorator("tips",e,n.tagsUpdateDecorator(e,i))}function s(e,n){return t.removeDecorator("tips",e,n)}return{readTips:i,onTipCreate:a,onTipUpdate:r,onTipDelete:s}}])}(),function(){"use strict";var e=angular.module("pipDataAnnouncement",["pipRest","pipDataModel","pipCacheAnnouncement"]);e.provider("pipDataAnnouncement",function(){this.readAnnouncesResolver=function(){return["$stateParams","pipRest","pipEnums",function(e,t,n){return t.announces().query().$promise}]},this.readCompletedAnnouncesResolver=function(){return["$stateParams","pipRest","pipEnums",function(e,t,n){return t.announces().query({status:n.EXECUTION_STATUS.COMPLETED}).$promise}]},this.readAnnounceResolver=function(){return["$stateParams","pipRest",function(e,t){return t.announces().get({id:e.id}).$promise}]},this.$get=["pipRest","$stateParams","pipDataModel","pipCacheAnnouncement",function(e,t,n,i){return{partyId:e.partyId,readAnnounces:function(n,a,r){return n.resource="announces",n.item=n.item||{},n.item.search=t.search,n.item.tags=t.search,n.item.party_id=e.partyId(t),i.readAnnounces(n,a,r)},updateAnnounce:function(e,t,a){e.resource="announces",e.skipTransactionBegin=!0,e.skipTransactionEnd=!1,n.update(e,i.onAnnounceCreate(e,t),a)},updateAnnounceWithFiles:function(e,t,a){e.skipTransactionEnd=!0,n.saveFiles(e,function(){e.resource="announces",e.skipTransactionBegin=!0,e.skipTransactionEnd=!1,n.update(e,i.onAnnounceUpdate(e,t),a)})},createAnnounceWithFiles:function(e,t,a){e.skipTransactionEnd=!0,n.saveFiles(e,function(){e.resource="announces",e.skipTransactionBegin=!0,e.skipTransactionEnd=!1,n.create(e,i.onAnnounceCreate(e,t),a)})},createAnnounce:function(e,t,a){e.resource="announces",e.skipTransactionBegin=!0,e.skipTransactionEnd=!1,n.create(e,i.onAnnounceCreate(e,t),a)},deleteAnnounce:function(e,t,a){e.resource="announces",n.remove(e,i.onAnnounceDelete(e,t),a)}}}]})}(),function(){"use strict";var e=angular.module("pipDataConfig",["pipRest"]);e.provider("pipDataConfig",["pipRestProvider",function(e){e.version("1.0"),this.version=function(t){e.version(t)},this.serverUrlFixed=function(t){e.serverUrlFixed(t)},this.serverUrl=function(t){e.serverUrl(t)},this.$get=["$rootScope","$http","$resource","pipRest",function(e,t,n,i){return{serverUrl:function(e){return i.serverUrl(e)},serverUrlFixed:function(){return i.serverUrlFixed(serverUrlFixed)},about:function(e,t){return i.about().call({},e,t)}}}]}])}(),function(){"use strict";var e=angular.module("pipDataDocument",["pipDataConfig","pipDataSession","angularFileUpload"]);e.provider("pipDataDocument",function(){this.$get=["$http","$upload","pipDataConfig","pipDataSession",function(e,t,n,i){var a=function(e){return e},r=function(e){return e};return{getDocumentUrl:function(e){var t=i.userId(),a=i.partyId()||t;return n.serverUrl()+"/api/parties/"+a+"/files/"+e},getDocumentPostUrl:function(e){var t=i.userId(),a=i.partyId()||t;return n.serverUrl()+"/api/parties/"+a+"/files/?name="+e},getDocumentContentUrl:function(e){var t=i.userId(),a=i.partyId()||t;return n.serverUrl()+"/api/parties/"+a+"/files/"+e+"/content"},deleteDocument:function(t,n,i){e({method:"DELETE",url:getDocumentUrl(t)}).then(n,function(e){i(r(e))})},createDocument:function(e,n,i,s){return t.http({url:this.getDocumentPostUrl(e.name),headers:{"Content-Type":e.type},data:e.data},function(e){null!=n&&n(a(e))},function(e){i(r(e))},s)}}}]})}(),function(){"use strict";var e=angular.module("pipDataFeedback",["pipRest","pipDataModel","pipCacheFeedback"]);e.provider("pipDataFeedback",function(){this.readFeedbacksResolver=function(){return["$stateParams","pipRest",function(e,t){return t.feedbacks().query().$promise}]},this.readFeedbackResolver=function(){return["$stateParams","pipRest",function(e,t){return t.feedbacks().get({id:e.id}).$promise}]},this.$get=["$stateParams","pipRest","pipDataModel","pipCacheFeedback",function(e,t,n,i){return{sendFeedback:function(e,t,i){e.resource="feedbacks",n.create(e,t,i)},readFeedbacks:function(n,a,r){return n.resource="feedbacks",n.item=n.item||{},n.item.party_id=t.partyId(e),i.readFeedbacks(n,a,r)},createFeedbackWithFiles:function(e,t,i){e.skipTransactionEnd=!0,n.saveFiles(e,function(){e.resource="feedbacks",e.skipTransactionBegin=!0,e.skipTransactionEnd=!1,n.create(e,t,i)})},updateFeedback:function(e,t,i){e.resource="feedbacks",e.skipTransactionBegin=!0,e.skipTransactionEnd=!1,n.update(e,t,i)},deleteFeedback:function(e,t,i){e.resource="feedbacks",n.remove(e,t,i)}}}]})}(),function(){"use strict";var e=angular.module("pipDataGuide",["pipRest","pipDataModel"]);e.provider("pipDataGuide",function(){this.$get=["pipRest","$stateParams","pipDataModel","pipCacheGuide",function(e,t,n,i){return{partyId:e.partyId,readGuides:function(n,a,r){return n.resource="guides",n.party_id=e.partyId(t),i.readGuides(n,a,r)},readIntroGuides:function(n,a,r){return n.resource="guides",n.party_id=e.partyId(t),n.type="intro",n.status="completed",i.readGuides(n,a,r)},readGuide:function(a,r,s){return a.resource="guides",a.item=a.item||{},a.item.party_id=e.partyId(t),a.item.id=a.item.id||t.id,n.readOne(a,i.onGuideUpdate(a,r),s)},createGuide:function(a,r,s){a.resource="guides",a.item=a.item||{},a.item.party_id=e.partyId(t),n.create(a,i.onGuideCreate(a,r),s)},createGuideWithFiles:function(e,t,a){e.skipTransactionEnd=!0,n.saveFiles(e,function(){e.resource="guides",e.skipTransactionBegin=!0,e.skipTransactionEnd=!1,n.create(e,i.onGuideCreate(e,t),a)})},updateGuide:function(e,t,a){e.resource="guides",e.skipTransactionBegin=!0,e.skipTransactionEnd=!1,n.update(e,i.onGuideUpdate(e,t),a)},updateGuideWithFiles:function(e,t,a){e.skipTransactionEnd=!0,n.saveFiles(e,function(){e.resource="guides",e.skipTransactionBegin=!0,e.skipTransactionEnd=!1,n.update(e,i.onGuideUpdate(e,t),a)})},deleteGuide:function(e,t,a){e.resource="guides",n.remove(e,i.onGuideDelete(e,t),a)}}}]})}(),function(){"use strict";var e=angular.module("pipDataImageSets",["pipRest","pipDataModel","pipCacheImageSet"]);e.provider("pipDataImageSets",function(){var e=15;this.readImageSetsResolver=function(){return["$stateParams","pipRest",function(t,n){return n.image_sets().get({paging:1,skip:0,take:e,search:t.search}).$promise}]},this.readImageSetResolver=function(){return["$stateParams","pipRest",function(e,t){return t.image_sets().get({id:e.id}).$promise}]},this.$get=["pipRest","$stateParams","pipDataModel","pipCacheImageSet",function(t,n,i,a){return{partyId:t.partyId,readImageSets:function(a,r,s,p){return a.resource="image_sets",a.skipTransactionBegin=!0,a.skipTransactionEnd=!1,a.item=a.item||{},a.item.skip=a.item.skip||0,a.item.search=n.search||a.item.search,a.item.party_id=t.partyId(n),a.item.take=e,a.item.paging=1,i.page(a,s,p)},readImageSet:function(e,r,s){return e.resource="image_sets",e.item=e.item||{},e.item.party_id=t.partyId(n),e.item.id=e.item.id||n.id,i.readOne(e,a.onImageSetUpdate(e,r),s)},updateImageSet:function(e,t,n){return e.resource="image_sets",e.skipTransactionBegin=!0,e.skipTransactionEnd=!1,i.update(e,t,n)},createImageSet:function(e,t,n){e.resource="image_sets",e.skipTransactionBegin=!0,e.skipTransactionEnd=!1,i.create(e,a.onImageSetCreate(e,t),n)},createImageSetWithFiles:function(e,t,n){e.skipTransactionEnd=!0,i.saveFiles(e,function(){e.resource="image_sets",e.skipTransactionBegin=!0,e.skipTransactionEnd=!1,i.create(e,a.onImageSetCreate(e,t),n)})},updateImageSetWithFiles:function(e,t,n){e.skipTransactionEnd=!0,i.saveFiles(e,function(){e.resource="image_sets",e.skipTransactionBegin=!0,e.skipTransactionEnd=!1,i.update(e,t,n)})},deleteImageSet:function(e,t,n){e.resource="image_sets",i.remove(e,t,n)}}}]})}(),function(){"use strict";var e=angular.module("pipDataParty",["pipDataConfig","pipRest"]);e.provider("pipDataParty",function(){this.$get=["pipRest","pipDataConfig",function(e,t){var n=function(e){return e},i=function(e){return e},a=function(e){return e};return{getParty:function(e){},createParty:function(t,a,r){e.parties().update(i(t),function(e){a(n(e))},r)},updateParty:function(t,r,s){e.parties().update(i(t),function(e){r(n(e))},function(e){s(a(e))})},partySettings:function(){return e.partySettings()}}}]})}(),function(){"use strict";var e=angular.module("pipDataSession",["pipDataConfig","pipRest","pipRest.Session"]);e.provider("pipDataSession",function(){this.$get=["pipRest","pipSession","pipDataConfig",function(e,t,n){var i=function(e){return e},a=function(e){return e};return{signin:function(e,n,r){return t.signin({serverUrl:e.serverUrl,email:e.email,password:e.password,remember:e.remember,adminOnly:!!e.adminOnly},function(e){n(i(e))},function(e){r(a(e))})},open:function(e){return t.open(e.serverUrl,e.user,e.password,e.remember)},signout:function(){return e.signout()},userSessions:function(){return e.userSessions()},userId:function(){return e.userId()},sessionId:function(){return e.sessionId()},partyId:function(t){return e.partyId()}}}]})}(),function(){"use strict";var e=angular.module("pipDataSettings",["pipRest","pipSessionData","pipSessionCache","pipDataModel"]);e.provider("pipDataSettings",["pipSessionDataProvider",function(e){this.readSettingsResolver=e.readSettingsResolver,this.$get=["$rootScope","$stateParams","pipRest","pipSessionCache","pipSession","pipDataModel",function(e,t,n,i,a,r){function s(e,t){return i.readSettings(e,t)}function p(e,t){return n.partySettings().get({party_id:a.userId()},function(t){t=t||{},i.onSettingsUpdate(t),e&&e(t)},t).$promise}function o(t,n,s,p){t=n?_.pick(t,n):t,t.party_id=a.userId();var o=_.cloneDeep(e.$settings);i.onSettingsUpdate(t);var u={};u.resource="partySettings",u.item=t,u.item.creator_id=a.userId(),r.create(u,s,function(e){i.onSettingsUpdate(o),p&&p(e)})}return{saveSettings:o,readSettings:s,reReadSettings:p}}]}])}(),function(){"use strict";var e=angular.module("pipDataTag",["pipRest","pipDataModel","pipCacheTag"]);e.provider("pipDataTag",function(){this.readTagsResolver=function(){return["$stateParams","pipRest","pipCacheTag",function(e,t,n){return n.readTags({item:{party_id:t.partyId(e)}})}]},this.$get=["$stateParams","$state","pipRest","pipDataModel","pipCacheTag",function(e,t,n,i,a){return{partyId:n.partyId,readTags:function(t,i,r){return t=t||{},t.item=t.item||{},null==t.item.party_id&&(t.item.party_id=n.partyId(e)),a.readTags(t,i,r)}}}]})}(),function(){"use strict";var e=angular.module("pipDataTip",["pipRest","pipDataModel"]);e.provider("pipDataTip",function(){this.readTipsResolver=function(){return["$stateParams","pipRest",function(e,t){return t.tips().query().$promise}]},this.readTipResolver=function(){return["$stateParams","pipRest",function(e,t){return t.tips().get({id:e.id}).$promise}]},this.$get=["pipRest","$stateParams","pipDataModel","pipCacheTip",function(e,t,n,i){return{partyId:e.partyId,readTips:function(n,a,r){return n.resource="tips",n.item=n.item||{},n.item.search=t.search,n.item.tags=t.search,n.item.party_id=e.partyId(t),i.readTips(n,a,r)},readTip:function(a,r,s){return a.resource="tips",a.item=a.item||{},a.item.party_id=e.partyId(t),a.item.id=a.item.id||t.id,n.readOne(a,i.onTipsUpdate(a,r),s)},createTip:function(a,r,s){a.resource="tips",a.item=a.item||{},a.item.party_id=e.partyId(t),n.create(a,i.onTipCreate(a,r),s)},createTipWithFiles:function(a,r,s){a.skipTransactionEnd=!0,a.item=a.item||{},a.item.party_id=e.partyId(t),n.saveFiles(a,function(){a.resource="tips",a.skipTransactionBegin=!0,a.skipTransactionEnd=!1,a.item.party_id=e.partyId(t),n.create(a,i.onTipCreate(a,r),s)},s)},updateTip:function(a,r,s){a.resource="tips",a.item=a.item||{},a.item.party_id=e.partyId(t),n.update(a,i.onTipUpdate(a,r),s)},updateTipWithFiles:function(a,r,s){a.skipTransactionEnd=!0,a.item=a.item||{},a.item.party_id=e.partyId(t),n.saveFiles(a,function(){a.resource="tips",a.skipTransactionBegin=!0,a.skipTransactionEnd=!1,a.item.party_id=e.partyId(t),n.update(a,i.onTipUpdate(a,r),s)})},deleteTip:function(e,t,a){e.resource="tips",n.remove(e,i.onTipDelete(e,t),a)}}}]})}(),function(){"use strict";var e=angular.module("pipDataUser",["pipDataConfig","pipRest"]);e.provider("pipDataUser",function(){this.$get=["pipRest","pipDataConfig","$stateParams","pipDataModel",function(e,t,n,i){var a=function(e){return e},r=function(e){return{name:e.name,email:e.email,password:e.password,language:e.language,theme:e.theme}},s=function(e){return e};return this.readUsersResolver=function(){return["$stateParams","pipRest",function(e,t){return t.users().page({party_id:e.id,paging:e.paging||1,skip:e.skip||0,take:e.take||15}).$promise}]},this.readUserResolver=function(){return["$stateParams","pipRest",function(e,t){return t.users().get({id:e.id,party_id:t.partyId(e)}).$promise}]},this.readActivitiesUserResolver=["$stateParams","pipRest","$rootScope",function(e,t,n){return t.partyActivities().page({party_id:n.$user.id,paging:1,skip:0,take:25}).$promise}],{signup:function(t,n,i){return e.signup(t.serverUrl).call(r(t),function(e){n(a(e))},function(e){s(s(e))})},recoverPassword:function(t,n,i){return e.recoverPassword(t.serverUrl).call({email:t.email},n,function(e){i(s(e))})},resetPassword:function(t,n,i){return e.resetPassword(t.serverUrl).call({email:t.email,code:t.code,password:t.password},n,function(e){i(s(e))})},changePassword:function(){return e.changePassword()},requestEmailVerification:function(){return e.requestEmailVerification()},verifyEmail:function(t,n,i){return e.verifyEmail(t.serverUrl).call({email:t.email,code:t.code},n,function(e){i(s(e))})},signupValidate:function(t,n,i){return e.signupValidate().call({email:t.email},n,i)},currentUser:function(t,n){return e.currentUser().call({},function(e){t(a(e))},function(e){n(s(e))})},readUsers:function(t,i,a,r){return e.users().page({party_id:e.partyId(n),paging:1,skip:t.start||t.item.skip||0,search:t.item.search,active:t.item.active,paid:t.item.paid,admin:t.item.admin,take:15},function(e){a&&a(e)},function(e){r(e)})},readUser:function(t,a,r){return t.resource="users",t.item=t.item||{},t.item.party_id=e.partyId(n),t.item.id=t.item.id||n.id,i.readOne(t,a,r)},updateUser:function(t,n,i,a){e.users().update(t.item,function(e){i&&i(e)},function(e){a(e)})}}}]})}(),function(){"use strict";var e=angular.module("pipUsersData",["pipRest"]);e.provider("pipUsersData",function(){this.$get=["pipRest","$stateParams","pipDataModel",function(e,t,n){return{partyId:e.partyId,readUsers:function(n,i,a,r){return e.users().page({party_id:e.partyId(t),paging:1,skip:n.start||n.item.skip||0,search:n.item.search,active:n.item.active,paid:n.item.paid,admin:n.item.admin,take:15},function(e){a&&a(e)},function(e){r(e)})},readUser:function(i,a,r){return i.resource="users",i.item=i.item||{},i.item.party_id=e.partyId(t),i.item.id=i.item.id||t.id,n.readOne(i,a,r)},updateUser:function(t,n,i,a){e.users().update(t.item,function(e){i&&i(e)},function(e){a(e)})}}}]})}();